<div class="register-container" [class.dark-theme]="isDarkTheme">
  <div class="register-card">
    <div class="theme-toggle">
      <button class="theme-btn" (click)="toggleTheme()" [attr.aria-label]="isDarkTheme ? 'Switch to light theme' : 'Switch to dark theme'">
        <i class="fas" [class.fa-sun]="isDarkTheme" [class.fa-moon]="!isDarkTheme"></i>
      </button>
    </div>

    <div class="register-header">
      <div class="register-logo medical-icon">
        <i class="fas fa-user-plus"></i>
      </div>
      <h1 class="register-title">Create Account</h1>
      <p class="register-subtitle">Join SciConnect Medical Research Platform</p>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onRegisterFormSubmit()" novalidate>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="firstName">
            <i class="fas fa-user"></i> First Name
          </label>
          <input 
            type="text" 
            id="firstName"
            formControlName="firstName" 
            class="form-control"
            placeholder="Enter your first name"
            [class.ng-invalid]="isFieldInvalid('firstName')"
            [class.ng-touched]="isFieldTouched('firstName')"
          >
          <div class="error-message" *ngIf="isFieldInvalid('firstName') && isFieldTouched('firstName')">
            <i class="fas fa-exclamation-circle"></i>
            <span *ngIf="registerForm.get('firstName')?.errors?.['required']">First name is required</span>
            <span *ngIf="registerForm.get('firstName')?.errors?.['minlength']">First name must be at least 2 characters</span>
            <span *ngIf="registerForm.get('firstName')?.errors?.['pattern']">First name can only contain letters and spaces</span>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" for="lastName">
            <i class="fas fa-user"></i> Last Name
          </label>
          <input 
            type="text" 
            id="lastName"
            formControlName="lastName" 
            class="form-control"
            placeholder="Enter your last name"
            [class.ng-invalid]="isFieldInvalid('lastName')"
            [class.ng-touched]="isFieldTouched('lastName')"
          >
          <div class="error-message" *ngIf="isFieldInvalid('lastName') && isFieldTouched('lastName')">
            <i class="fas fa-exclamation-circle"></i>
            <span *ngIf="registerForm.get('lastName')?.errors?.['required']">Last name is required</span>
            <span *ngIf="registerForm.get('lastName')?.errors?.['minlength']">Last name must be at least 2 characters</span>
            <span *ngIf="registerForm.get('lastName')?.errors?.['pattern']">Last name can only contain letters and spaces</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="userName">
          <i class="fas fa-at"></i> Username
        </label>
        <input 
          type="text" 
          id="userName"
          formControlName="userName" 
          class="form-control"
          placeholder="Choose a username"
          [class.ng-invalid]="isFieldInvalid('userName')"
          [class.ng-touched]="isFieldTouched('userName')"
        >
        <div class="error-message" *ngIf="isFieldInvalid('userName') && isFieldTouched('userName')">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('userName')?.errors?.['required']">Username is required</span>
          <span *ngIf="registerForm.get('userName')?.errors?.['minlength']">Username must be at least 3 characters</span>
          <span *ngIf="registerForm.get('userName')?.errors?.['pattern']">Username can only contain letters, numbers, and underscores</span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="email">
          <i class="fas fa-envelope"></i> Email
        </label>
        <input 
          type="email" 
          id="email"
          formControlName="email" 
          class="form-control"
          placeholder="Enter your email address"
          [class.ng-invalid]="isFieldInvalid('email')"
          [class.ng-touched]="isFieldTouched('email')"
        >
        <div class="error-message" *ngIf="isFieldInvalid('email') && isFieldTouched('email')">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('email')?.errors?.['required']">Email is required</span>
          <span *ngIf="registerForm.get('email')?.errors?.['email']">Please enter a valid email address</span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="role">
          <i class="fas fa-user-tag"></i> Role
        </label>
        <select 
          id="role"
          class="form-control"
          formControlName="role"
          (change)="onRoleChange()"
        >
          <option value="guest">Guest</option>
          <option value="administrator">Administrator</option>
          <option value="pm">Project Manager</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label" for="password">
          <i class="fas fa-lock"></i> Password
        </label>
        <div class="password-input-container">
          <input 
            [type]="showPassword ? 'text' : 'password'"
            id="password"
            formControlName="password" 
            class="form-control"
            placeholder="Create a strong password"
            [class.ng-invalid]="isFieldInvalid('password')"
            [class.ng-touched]="isFieldTouched('password')"
          >
          <button 
            type="button" 
            class="password-toggle"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
          >
            <i class="fas" [class.fa-eye]="!showPassword" [class.fa-eye-slash]="showPassword"></i>
          </button>
        </div>
        <div class="password-strength" *ngIf="registerForm.get('password')?.value">
          <div class="strength-bar">
            <div class="strength-fill" [style.width.%]="getPasswordStrength() === 'weak' ? 33 : getPasswordStrength() === 'medium' ? 66 : 100" [style.background-color]="getPasswordStrengthColor()"></div>
          </div>
          <span class="strength-text" [style.color]="getPasswordStrengthColor()">
            Password strength: {{ getPasswordStrength() }}
          </span>
        </div>
        <div class="error-message" *ngIf="isFieldInvalid('password') && isFieldTouched('password')">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('password')?.errors?.['required']">Password is required</span>
          <span *ngIf="registerForm.get('password')?.errors?.['minlength']">Password must be at least 8 characters</span>
          <span *ngIf="registerForm.get('password')?.errors?.['pattern']">Password must contain uppercase, lowercase, number, and special character</span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="confirmPassword">
          <i class="fas fa-lock"></i> Confirm Password
        </label>
        <div class="password-input-container">
          <input 
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword"
            formControlName="confirmPassword" 
            class="form-control"
            placeholder="Confirm your password"
            [class.ng-invalid]="isFieldInvalid('confirmPassword')"
            [class.ng-touched]="isFieldTouched('confirmPassword')"
          >
          <button 
            type="button" 
            class="password-toggle"
            (click)="toggleConfirmPasswordVisibility()"
            [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'"
          >
            <i class="fas" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"></i>
          </button>
        </div>
        <div class="error-message" *ngIf="registerForm.errors?.['passwordMismatch'] && registerForm.get('confirmPassword')?.touched">
          <i class="fas fa-exclamation-circle"></i>
          Passwords do not match
        </div>
      </div>

      <div class="form-group" *ngIf="showVerificationCode">
        <label class="form-label" for="verificationCode">
          <i class="fas fa-key"></i> Verification Code
        </label>
        <div class="verification-code-container">
          <input type="text" id="verificationCode" formControlName="verificationCode" class="form-control" placeholder="Enter verification code" [class.ng-invalid]="isFieldInvalid('verificationCode')" [class.ng-touched]="isFieldTouched('verificationCode')">
          <button type="button" class="btn-generate-code" (click)="onGenerateVerificationCode()" [disabled]="isLoading">
            <i class="fas fa-sync-alt"></i> Generate Code
          </button>
        </div>
        <div class="error-message" *ngIf="isFieldInvalid('verificationCode') && isFieldTouched('verificationCode')">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('verificationCode')?.errors?.['required']">Verification code is required for administrator registration</span>
        </div>
      </div>

      <div class="form-group" *ngIf="registerForm.get('role')?.value === 'administrator'">
        <div class="admin-registration-info">
          <p class="info-text">
            <i class="fas fa-info-circle"></i>
            Administrator registration requires approval. Click the button below to request access.
          </p>
          <button type="button" class="btn-request-admin" (click)="onRequestAdminRegistration()" [disabled]="isLoading">
            <i class="fas fa-user-shield"></i> Request Admin Access
          </button>
        </div>
      </div>

      <button 
        type="submit" 
        class="btn-register"
        [disabled]="registerForm.invalid || isLoading"
      >
        <span class="loading-spinner" *ngIf="isLoading"></span>
        <span *ngIf="!isLoading">
          <i class="fas fa-user-plus"></i> Create Account
        </span>
        <span *ngIf="isLoading">Creating Account...</span>
      </button>
    </form>

    <div class="error-message" *ngIf="registerError" style="margin-top: 15px; text-align: center;">
      <i class="fas fa-exclamation-triangle"></i>
      {{ registerError }}
    </div>

    <div class="success-message" *ngIf="registerSuccess" style="margin-top: 15px; text-align: center;">
      <i class="fas fa-check-circle"></i>
      {{ registerSuccess }}
    </div>

    <div class="login-link">
      <span>Already have an account? </span>
      <a (click)="onBackToLogin()">
        <i class="fas fa-sign-in-alt"></i> Sign In
      </a>
    </div>
  </div>
</div>

